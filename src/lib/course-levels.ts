/**
 * بيانات المستويات للمراجعة الداخلية
 * يتم استخدامها لتجميع المحاور حسب المستويات
 */

export interface LevelModule {
  title: string;
  description?: string;
  topics: string[];
  duration?: string;
  lessons?: number;
}

export interface AuditLevel {
  id: number;
  title: string;
  description: string;
  color: string;
  modules: LevelModule[];
}

export const INTERNAL_AUDIT_LEVELS: AuditLevel[] = [
  {
    id: 1,
    title: 'المستوى الأول - التأسيس (Foundation)',
    description: 'أساسيات المراجعة الداخلية والمفاهيم الأولية',
    color: 'from-blue-500 to-blue-600',
    modules: [
      {
        title: 'المحور الأول: أساسيات المراجعة الداخلية',
        description: 'مقدمة شاملة لفهم المراجعة الداخلية ومبادئها',
        topics: [
          'تعريف وأهداف المراجعة الداخلية',
          'المفهوم والدور الاستراتيجي للمراجعة الداخلية',
          'المعايير والكفاءات المطلوبة',
          'منهجية التدقيق',
          'أخلاقيات المهنة',
          'أدلة إدارة المراجعة الداخلية',
          'ميثاق المراجعة الداخلية',
          'هيكل الإدارة - الصلاحيات - المسؤوليات'
        ],
        duration: '4 أسابيع',
        lessons: 12
      },
      {
        title: 'الإطار التنظيمي والأنظمة',
        topics: [
          'الأنظمة واللوائح المنظمة للمراجعة الداخلية',
          'الإطار التنظيمي للمراجعة',
          'القوانين واللوائح المتعلقة',
          'الهيئات التنظيمية'
        ],
        duration: '3 أسابيع',
        lessons: 8
      },
      {
        title: 'المحور الثاني: إدارة المخاطر',
        description: 'فهم وتقييم وإدارة المخاطر',
        topics: [
          'تحديد المخاطر',
          'طرق تحديد وتصنيف المخاطر',
          'تقييم المخاطر',
          'مفهوم المراجعة المبنية على المخاطر',
          'مصفوفة المخاطر (Risk Matrix)',
          'إعداد خطة المراجعة السنوية',
          'خطوات إعداد الخطة خطوة بخطوة',
          'مراجعة الخطة وتحديثها'
        ],
        duration: '4 أسابيع',
        lessons: 10
      },
      {
        title: 'إعداد برنامج المراجعة',
        topics: [
          'خطوات إعداد البرنامج',
          'النطاق والعمل التنفيذي',
          'أوراق العمل (Workpapers)',
          'التوثيق والاعتماد'
        ],
        duration: '2 أسابيع',
        lessons: 6
      },
      {
        title: 'تنفيذ إجراءات المراجعة',
        topics: [
          'جمع الأدلة والمستندات',
          'أساليب وأدوات المراجعة',
          'توثيق النتائج',
          'التحقق من الضوابط الداخلية'
        ],
        duration: '3 أسابيع',
        lessons: 9
      },
      {
        title: 'تحليل النتائج وتقييم المخاطر',
        topics: [
          'التمييز بين الملاحظة، النتيجة، والاستنتاج',
          'تقييم فعالية الرقابة الداخلية',
          'ربط النتائج بالأهداف الاستراتيجية'
        ],
        duration: '2 أسابيع',
        lessons: 7
      },
      {
        title: 'إعداد التقارير',
        topics: [
          'مكونات تقرير المراجعة',
          'الصياغة الموضوعية والحيادية',
          'التقارير التفصيلية مقابل المختصرة'
        ],
        duration: '2 أسابيع',
        lessons: 6
      },
      {
        title: 'متابعة تنفيذ التوصيات',
        topics: [
          'آلية خطة العمل لتنفيذ التوصيات',
          'تحديد المسؤوليات والجدول الزمني',
          'رفع تقارير المتابعة الدورية'
        ],
        duration: '2 أسابيع',
        lessons: 5
      },
      {
        title: 'التحضير لمقابلات العمل للمراجعين الداخليين',
        topics: [
          'المهارات المطلوبة في مقابلات المراجعة الداخلية',
          'إعداد السيرة الذاتية المهنية',
          'الأسئلة الشائعة في مقابلات المراجعين',
          'نماذج المقابلات العملية',
          'نصائح للنجاح في مقابلات المراجعة الداخلية'
        ],
        duration: '2 أسابيع',
        lessons: 6
      }
    ]
  },
  {
    id: 2,
    title: 'المستوى الثاني - الريادة (Leadership)',
    description: 'التطبيق العملي والأدوات المتقدمة',
    color: 'from-purple-500 to-purple-600',
    modules: [
      {
        title: 'إطار COSO العالمي',
        topics: [
          'تصميم وتقييم أنظمة الرقابة الداخلية',
          'حماية الأصول',
          'دقة التقارير المالية',
          'ضمان الالتزام بالقوانين'
        ],
        duration: '6 أسابيع',
        lessons: 16
      },
      {
        title: 'التقييم المستمر وتحسين الأداء',
        topics: [
          'مراقبة الجودة (أدوات التقييم الذاتي - مراجعة خارجية)',
          'تحديد الفجوات في الأداء',
          'خطط تطوير الكفاءات المهنية'
        ],
        duration: '4 أسابيع',
        lessons: 10
      },
      {
        title: 'أدوات المراجعة المتقدمة',
        topics: [
          'استخدام التقنيات والأدوات الحديثة في المراجعة',
          'تحليل البيانات في المراجعة',
          'كيفية استخدام تحليل البيانات',
          'أدوات تحليل البيانات',
          'مراجعة نظم وأمن المعلومات (IT Audit)',
          'تقييم ضوابط الوصول للأنظمة',
          'مراجعة التطبيقات والبرامج',
          'تحليل البيانات باستخدام (ACL, IDEA, Power BI)',
          'الحوكمة الرقمية والامتثال التقني'
        ],
        duration: '8 أسابيع',
        lessons: 20
      },
      {
        title: 'منهجية COBIT لحوكمة تكنولوجيا المعلومات',
        topics: [
          'ربط الأهداف التقنية بالأهداف التشغيلية',
          'علاقة COBIT و COSO في الرقابة الداخلية'
        ],
        duration: '5 أسابيع',
        lessons: 12
      },
      {
        title: 'الاحتيال (Fraud Management)',
        topics: [
          'أنواع الاحتيال (المالي، التشغيلي، الإلكتروني)',
          'تحليل مخاطر الاحتيال',
          'تقييم ضوابط الوقاية والكشف',
          'سياسات مكافحة الاحتيال',
          'آليات الإبلاغ والحماية',
          'إعداد تقارير التحقيقات الداخلية'
        ],
        duration: '6 أسابيع',
        lessons: 15
      },
      {
        title: 'الحوكمة المخاطر الامتثال (GRC)',
        topics: [
          'تصميم وتنفيذ برامج الحوكمة المتكاملة',
          'دمج الحوكمة مع إدارة الرقابة والمخاطر',
          'الحوكمة الرقمية والالتزام بالقوانين واللوائح'
        ],
        duration: '7 أسابيع',
        lessons: 18
      },
      {
        title: 'حالات عملية متقدمة',
        topics: [
          'أمثلة واقعية من الصناعات المختلفة',
          'تدريب جماعي وتحليل مواقف',
          'محاكاة جلسات مراجعة حقيقية'
        ],
        duration: '5 أسابيع',
        lessons: 13
      },
      {
        title: 'الدليل العملي للنماذج التشغيلية',
        topics: [
          'أدلة وسياسات وإجراءات شاملة',
          'نماذج إدارات ومصفوفة صلاحيات',
          'خطط مراجعة سنوية وربعية',
          'مؤشرات الأداء الرئيسية (KPIS)',
          'نماذج التقييم والمتابعة'
        ],
        duration: '6 أسابيع',
        lessons: 15
      }
    ]
  },
  {
    id: 3,
    title: 'المستوى الثالث - تطوير الكفاءات المتكاملة',
    description: 'المعايير الدولية والقيادة الإستراتيجية',
    color: 'from-green-500 to-green-600',
    modules: [
      {
        title: 'المهارات المالية لغير الماليين',
        topics: [
          'فهم القوائم المالية الأساسية (الدخل، الميزانية، التدفقات)',
          'مؤشرات الأداء المالي والتشغيلي',
          'التحليل المبسط وربط النتائج بالمخاطر التشغيلية',
          'النسب المالية الأساسية وتفسيرها'
        ],
        duration: '8 أسابيع',
        lessons: 20
      },
      {
        title: 'المعايير الدولية للمراجعة الداخلية',
        topics: [
          'معايير IIA',
          'المعايير الدولية للمراجعين الداخليين',
          'تطبيق المعايير الدولية',
          'كيفية تطبيق المعايير في الواقع',
          'المصطلحات المالية والإدارية والمحاسبية الأساسية',
          'إعداد عروض PowerPoint احترافية للمراجعة',
          'استخدام Excel المتقدم لتحليل البيانات',
          'استخدام Power BI للإعداد التقارير التفاعلية',
          'اللغة الإنجليزية في سياق المراجعة الداخلية'
        ],
        duration: '10 أسابيع',
        lessons: 25
      },
      {
        title: 'مهارات الإقناع والتفاوض وكتابة التقارير',
        topics: [
          'فن إقناع الإدارة بجدوى التوصيات',
          'استخدام البيانات والأدلة لصياغة الآراء المهنية',
          'التواصل الفعال مع الأنماط المختلفة من الشخصيات',
          'التفاوض البناء وإدارة الاعتراضات باحترافية',
          'التأثير في عملية اتخاذ القرارات',
          'دعم سياسات الشركة وتوصيل رسائل الإدارة',
          'كتابة التقارير المؤثرة والواضحة',
          'تقنيات العرض والتقديم المؤثر'
        ],
        duration: '12 أسابيع',
        lessons: 30
      }
    ]
  }
];

/**
 * تحديد المستوى الذي ينتمي إليه المحور بناءً على عنوانه
 */
export function getModuleLevel(moduleTitle: string, courseTitle?: string): number | undefined {
  // إذا كان الكورس هو المراجعة الداخلية
  if (courseTitle && (
    courseTitle.includes('المراجعة الداخلية') ||
    courseTitle.includes('مراجعة داخلية') ||
    courseTitle.toLowerCase().includes('internal audit')
  )) {
    const title = moduleTitle.toLowerCase();
    
    // المستوى الأول
    if (
      title.includes('أساسيات') ||
      title.includes('تأسيس') ||
      title.includes('المحور الأول') ||
      title.includes('الإطار التنظيمي') ||
      title.includes('إدارة المخاطر') ||
      title.includes('برنامج المراجعة') ||
      title.includes('تنفيذ إجراءات') ||
      title.includes('تحليل النتائج') ||
      title.includes('إعداد التقارير') ||
      title.includes('متابعة تنفيذ') ||
      title.includes('التحضير لمقابلات')
    ) {
      return 1;
    }
    
    // المستوى الثاني
    if (
      title.includes('coso') ||
      title.includes('التقييم المستمر') ||
      title.includes('أدوات المراجعة المتقدمة') ||
      title.includes('cobit') ||
      title.includes('الاحتيال') ||
      title.includes('fraud') ||
      title.includes('grc') ||
      title.includes('حالات عملية متقدمة') ||
      title.includes('الدليل العملي')
    ) {
      return 2;
    }
    
    // المستوى الثالث
    if (
      title.includes('المهارات المالية') ||
      title.includes('المعايير الدولية') ||
      title.includes('مهارات الإقناع') ||
      title.includes('التفاوض')
    ) {
      return 3;
    }
  }
  
  return undefined;
}

/**
 * إضافة معلومات المستوى للمحاور
 */
export function addLevelsToModules(modules: any[], courseTitle?: string): any[] {
  return modules.map((module, index) => {
    const level = getModuleLevel(module.title, courseTitle);
    return {
      ...module,
      level: level || (index < 9 ? 1 : index < 17 ? 2 : 3), // توزيع افتراضي بناءً على الفهرس
    };
  });
}

